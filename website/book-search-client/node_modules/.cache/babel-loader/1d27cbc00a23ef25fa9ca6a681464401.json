{"ast":null,"code":"module.exports = function (arr, search, comparitor) {\n  if (!arr) return -1; // as long as it has a length i will try and itterate over it.\n\n  if (arr.length === undefined) return -1;\n  if (!comparitor) comparitor = module.exports._defaultComparitor();\n  return bs(arr, search, comparitor);\n};\n\nmodule.exports.first = function (arr, search, comparitor) {\n  return module.exports.closest(arr, search, {\n    exists: true\n  }, comparitor);\n};\n\nmodule.exports.last = function (arr, search, comparitor) {\n  return module.exports.closest(arr, search, {\n    exists: true,\n    end: true\n  }, comparitor);\n};\n\nmodule.exports.closest = function (arr, search, opts, comparitor) {\n  if (typeof opts === 'function') {\n    comparitor = opts;\n    opts = {};\n  }\n\n  if (arr.length === 0) return -1;\n  if (arr.length === 1) return 0;\n  opts = opts || {};\n  if (!comparitor) comparitor = this._defaultComparitor();\n  var closest = bsclosest(arr, search, comparitor, opts.end, opts.exists ? false : true);\n  if (closest > arr.length - 1) closest = arr.length - 1;else if (closest < 0) closest = 0;\n  return closest;\n}; // inserts element into the correct sorted spot into the array\n\n\nmodule.exports.insert = function (arr, search, opts, comparitor) {\n  if (typeof opts === 'function') {\n    comparitor = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n  if (!comparitor) comparitor = module.exports._defaultComparitor();\n\n  if (!arr.length) {\n    arr[0] = search;\n    return 0;\n  }\n\n  var closest = module.exports.closest(arr, search, comparitor);\n  var cmp = comparitor(arr[closest], search);\n\n  if (cmp < 0) {\n    //less\n    arr.splice(++closest, 0, search);\n  } else if (cmp > 0) {\n    arr.splice(closest, 0, search);\n  } else {\n    if (opts.unique) {\n      arr[closest] = search;\n    } else {\n      // im equal. this value should be appended to the list of existing same sorted values.\n      while (comparitor(arr[closest], search) === 0) {\n        if (closest >= arr.length - 1) break;\n        closest++;\n      }\n\n      arr.splice(closest, 0, search);\n    }\n  }\n\n  return closest;\n}; // this method returns the start and end indicies of a range. [start,end]\n\n\nmodule.exports.range = function (arr, from, to, comparitor) {\n  if (!comparitor) comparitor = module.exports._defaultComparitor();\n  var fromi = module.exports.closest(arr, from, comparitor);\n  var toi = module.exports.closest(arr, to, {\n    end: true\n  }, comparitor); // this is a hack. \n  // i should be able to fix the algorithm and generate a correct range.\n\n  while (fromi <= toi) {\n    if (comparitor(arr[fromi], from) > -1) break;\n    fromi++;\n  }\n\n  while (toi >= fromi) {\n    if (comparitor(arr[toi], to) < 1) break;\n    toi--;\n  }\n\n  return [fromi, toi];\n}; // this method returns the values of a range;\n\n\nmodule.exports.rangeValue = function (arr, from, to, comparitor) {\n  var range = module.exports.range(arr, from, to, comparitor);\n  return arr.slice(range[0], range[1] + 1);\n}; //\n\n\nmodule.exports.indexObject = function (o, extractor) {\n  var index = [];\n  Object.keys(o).forEach(function (k) {\n    index.push({\n      k: k,\n      v: extractor(o[k])\n    });\n  });\n  return index.sort(function (o1, o2) {\n    return o1.v - o2.v;\n  });\n};\n\nmodule.exports.cmp = function (v1, v2) {\n  return v1 - v2;\n};\n\nmodule.exports._defaultComparitor = function () {\n  var indexMode, indexModeSearch;\n  return function (v, search) {\n    // support the object format of generated indexes\n    if (indexMode === undefined) {\n      if (typeof v === 'object' && v.hasOwnProperty('v')) indexMode = true;\n      if (typeof search === 'object' && search.hasOwnProperty('v')) indexModeSearch = true;\n    }\n\n    if (indexMode) v = v.v;\n    if (indexModeSearch) search = search.v;\n    return v - search;\n  };\n};\n\nmodule.exports._binarySearch = bs;\nmodule.exports._binarySearchClosest = bsclosest;\n\nfunction bs(arr, search, comparitor) {\n  var max = arr.length - 1,\n      min = 0,\n      middle,\n      cmp; // continue searching while key may exist\n\n  while (max >= min) {\n    middle = mid(min, max);\n    cmp = comparitor(arr[middle], search, middle);\n\n    if (cmp < 0) {\n      min = middle + 1;\n    } else if (cmp > 0) {\n      max = middle - 1;\n    } else {\n      return middle;\n    }\n  } // key not found\n\n\n  return -1;\n}\n\nfunction bsclosest(arr, search, comparitor, invert, closest) {\n  var mids = {},\n      min = 0,\n      max = arr.length - 1,\n      middle,\n      cmp,\n      sanity = arr.length;\n\n  while (min < max) {\n    middle = midCareful(min, max, mids);\n    cmp = comparitor(arr[middle], search, middle);\n\n    if (invert) {\n      if (cmp > 0) max = middle - 1;else min = middle;\n    } else {\n      if (cmp < 0) min = middle + 1;else max = middle;\n    }\n\n    if (! --sanity) break;\n  }\n\n  if (max == min && comparitor(arr[min], search) === 0) return min;\n\n  if (closest) {\n    var match = comparitor(arr[min], search);\n    if (min == arr.length - 1 && match < 0) return min;\n    if (min == 0 && match > 0) return 0;\n    return closest ? invert ? min + 1 : min - 1 : -1;\n  }\n\n  return -1;\n}\n\nfunction mid(v1, v2) {\n  return v1 + Math.floor((v2 - v1) / 2);\n}\n\nfunction midCareful(v1, v2, mids) {\n  var mid = v1 + Math.floor((v2 - v1) / 2);\n  if (mids[mid]) mid = v1 + Math.ceil((v2 - v1) / 2);\n  mids[mid] = 1;\n  return mid;\n}","map":{"version":3,"sources":["/Users/yussefsoudan/Studies/Uni/year-4-cs/TTDS/CW3/ttds-14/website/book-search-client/node_modules/binarysearch/index.js"],"names":["module","exports","arr","search","comparitor","length","undefined","_defaultComparitor","bs","first","closest","exists","last","end","opts","bsclosest","insert","cmp","splice","unique","range","from","to","fromi","toi","rangeValue","slice","indexObject","o","extractor","index","Object","keys","forEach","k","push","v","sort","o1","o2","v1","v2","indexMode","indexModeSearch","hasOwnProperty","_binarySearch","_binarySearchClosest","max","min","middle","mid","invert","mids","sanity","midCareful","match","Math","floor","ceil"],"mappings":"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","sourcesContent":["\n\nmodule.exports = function(arr,search,comparitor) {\n  if(!arr) return -1;\n  // as long as it has a length i will try and itterate over it.\n  if(arr.length === undefined) return -1;\n  \n  if(!comparitor) comparitor = module.exports._defaultComparitor();\n\n  return bs(arr,search,comparitor);\n}\n\nmodule.exports.first = function(arr,search,comparitor) {\n  return module.exports.closest(arr,search,{exists:true},comparitor);\n}\n\nmodule.exports.last = function(arr,search,comparitor) {\n  return module.exports.closest(arr,search,{exists:true,end:true},comparitor);\n}\n\nmodule.exports.closest = function(arr,search,opts,comparitor) {\n\n  if(typeof opts === 'function') {\n    comparitor = opts;\n    opts = {};\n  }\n\n  if(arr.length === 0) return -1;\n  if(arr.length === 1) return 0;\n\n  opts = opts||{};\n  if(!comparitor) comparitor = this._defaultComparitor();\n  \n  var closest = bsclosest(arr, search, comparitor, opts.end, opts.exists?false:true);\n\n  if(closest > arr.length-1) closest = arr.length-1;\n  else if(closest < 0) closest = 0;\n\n  return closest;\n}\n\n// inserts element into the correct sorted spot into the array\nmodule.exports.insert = function(arr,search,opts,comparitor){ \n\n  if(typeof opts === 'function') {\n    comparitor = opts;\n    opts = {};\n  }\n\n  opts = opts||{};\n  if(!comparitor) comparitor = module.exports._defaultComparitor();\n  if(!arr.length) {\n    arr[0] = search;\n    return 0;\n  }\n\n  var closest = module.exports.closest(arr,search,comparitor);\n\n  var cmp = comparitor(arr[closest],search);\n  if(cmp < 0) {//less\n    arr.splice(++closest,0,search);\n  } else if(cmp > 0){ \n    arr.splice(closest,0,search);\n  } else {\n    if(opts.unique){\n      arr[closest] = search;\n    } else {\n      // im equal. this value should be appended to the list of existing same sorted values.\n      while(comparitor(arr[closest],search) === 0){\n        if(closest >= arr.length-1) break;\n        closest++;\n      }\n\n      arr.splice(closest,0,search);\n    }\n  }\n  return closest;\n}\n\n// this method returns the start and end indicies of a range. [start,end]\nmodule.exports.range = function(arr,from,to,comparitor) {\n  if(!comparitor) comparitor = module.exports._defaultComparitor();\n\n  var fromi = module.exports.closest(arr,from,comparitor);\n\n  var toi = module.exports.closest(arr,to,{end:true},comparitor);\n\n  // this is a hack. \n  // i should be able to fix the algorithm and generate a correct range.\n\n  while(fromi <= toi){ \n    if(comparitor(arr[fromi],from) > -1) break;\n\n    fromi++\n  }\n\n  while(toi >= fromi){ \n    if(comparitor(arr[toi],to) < 1) break;\n    toi--;\n  }\n\n  return [fromi,toi];\n}\n\n// this method returns the values of a range;\nmodule.exports.rangeValue = function(arr,from,to,comparitor){\n  var range = module.exports.range(arr,from,to,comparitor);\n  return arr.slice(range[0],range[1]+1);\n}\n\n//\nmodule.exports.indexObject = function(o,extractor) {\n  var index = [];\n  \n  Object.keys(o).forEach(function(k){\n    index.push({k:k,v:extractor(o[k])});\n  });\n\n  return index.sort(function(o1,o2){\n    return o1.v - o2.v;\n  });\n}\n\nmodule.exports.cmp = function(v1,v2){\n  return v1 - v2;\n}\n\nmodule.exports._defaultComparitor = function() {\n  var indexMode,indexModeSearch;\n  return function(v,search){\n    // support the object format of generated indexes\n    if(indexMode === undefined){\n      if(typeof v === 'object' && v.hasOwnProperty('v')) indexMode = true;\n      if(typeof search === 'object' && search.hasOwnProperty('v')) indexModeSearch = true\n    }\n\n    if(indexMode) v = v.v;\n    if(indexModeSearch) search = search.v;\n\n    return v - search;\n  };\n};\n\nmodule.exports._binarySearch = bs;\nmodule.exports._binarySearchClosest = bsclosest;\n\nfunction bs(arr, search, comparitor) {\n\n  var max = arr.length-1,min = 0,middle,cmp;\n  // continue searching while key may exist\n  while (max >= min) {\n    middle = mid(min, max);\n\n    cmp = comparitor(arr[middle],search,middle);\n\n    if (cmp < 0) {\n      min = middle + 1;\n    } else if (cmp > 0) {\n      max = middle - 1;\n    } else {\n      return middle;\n    }\n  }\n  // key not found\n  return -1;\n}\n\nfunction bsclosest(arr, search, comparitor, invert, closest) {\n  var mids = {}\n  , min = 0,max = arr.length-1,middle,cmp\n  , sanity = arr.length;\n\n  while (min < max) {\n    middle = midCareful(min, max,mids); \n    cmp = comparitor(arr[middle],search,middle);\n    if(invert){\n      if (cmp > 0)max = middle - 1;\n      else min = middle;   \n    } else {\n      if (cmp < 0)min = middle + 1;\n      else max = middle;\n    }\n    if(!--sanity) break;\n  }\n   \n  if (max == min && comparitor(arr[min],search) === 0) return min;\n  \n  if(closest) {\n    var match = comparitor(arr[min],search);\n    if(min == arr.length-1 && match < 0) return min;\n    if(min == 0 && match > 0) return 0;\n\n    return closest?(invert?min+1:min-1):-1;\n  } \n  return -1; \n}\n\nfunction mid(v1,v2){\n  return v1+Math.floor((v2-v1)/2);\n}\n\nfunction midCareful(v1,v2,mids){\n  var mid = v1+Math.floor((v2-v1)/2);\n  if(mids[mid]) mid = v1+Math.ceil((v2-v1)/2);\n  mids[mid] = 1;\n  return mid;\n}\n"]},"metadata":{},"sourceType":"script"}